<html><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><html><script src="./all.js"></script><head>	<title>BgToolKit</title>	<link href="http://libs.useso.com/js/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">	<style type="text/css">		canvas{border:dashed 2px #CCC}	</style></head>	<body>		<image id='fgImage_defualt' src='./fg.jpg' style="display:none;" />		<image id='bgImage_defualt' src='./bg.jpg' style="display:none;" />		<input type="file" accept="image/*" id="bgFileChooser" style="display:none;" />		<input type="file" accept="image/*" id="fgFileChooser" style="display:none;" />		<br />		<div class="section">		<div class="container">			<div class="row">				<div class="col-md-12 text-center">					<div class="btn-group btn-group-lg">						<a href="#" class="btn btn-success" onclick="chooseBg()">背景</a>						<a href="#" class="btn btn-primary" onclick="chooseFg()">前景</a>					</div>				</div>			</div>		</div>		<br />		<div style="width:800px;margin:0 auto;">			<canvas id="bgCanvas" width="800px" height="600px"></canvas>		</div>				<script type="text/javascript">theCanvas=document.getElementById("bgCanvas");ctx=theCanvas.getContext("2d");bgFileChooser=document.getElementById("bgFileChooser");fgFileChooser=document.getElementById("fgFileChooser");stage=new CVS.$stage(theCanvas);tmimg=new TextureMapping.Image(theCanvas,document.getElementById("fgImage_defualt"),8);backgroundImage=document.getElementById("bgImage_defualt");bgFileChooser.addEventListener("change",function(c){var b=bgFileChooser.files[0];var a=new Image();a.src=URL.createObjectURL(b);backgroundImage=a});fgFileChooser.addEventListener("change",function(c){var b=fgFileChooser.files[0];var a=new Image();a.src=URL.createObjectURL(b);tmimg=new TextureMapping.Image(theCanvas,a,8)});controlPoint=[];activeControlPoint=null;function createControlPoint(a,c){var b=new CVS.$sprite(stage.ctx,function(){this.x=a;this.y=c;this.width=6;this.height=6;this.draw=function(){stage.ctx.strokeRect(0,0,this.width,this.height)}});b.addEventListener("mouseover",function(){document.body.style.cursor="move"});b.addEventListener("mouseout",function(){document.body.style.cursor="default"});b.addEventListener("mousedown",function(){activeControlPoint=b});stage.addChild(b);return b}stage.addEventListener("mousemove",function(a,b){if(activeControlPoint){activeControlPoint.x=a;activeControlPoint.y=b}});stage.addEventListener("mouseup",function(a,b){activeControlPoint=null});function chooseBg(){bgFileChooser.click()}function chooseFg(){fgFileChooser.click()}ctA=createControlPoint(300,200);ctB=createControlPoint(300+320,200);ctC=createControlPoint(300+320,200+240);ctD=createControlPoint(300,200+240);var run=function(){stage.render();tmimg.draw3D({X:ctA.x+3,Y:ctA.y+3},{X:ctB.x+3,Y:ctB.y+3},{X:ctC.x+3,Y:ctC.y+3},{X:ctD.x+3,Y:ctD.y+3});setTimeout(run,20)};run();</script>	</body></html>